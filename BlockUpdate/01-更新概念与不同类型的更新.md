# #01 广义更新与不同类型的更新

本部分是更新理论的入门。

**基础部分**
- 更新理论的认识
- NC更新、PP更新、比较器更新等不同类型的更新
- 方块放置时的自检行为

**进阶部分**（源码分析）
- 简要的NC更新与PP更新的调用与响应
- 方块自检的调用

## 1.1 广义更新

在Minecraft中，方块与方块通过互相“通知”来建立相互的联系。

我们以**破坏某个石头按钮所附着的木板**为例：一个附着在木板上的石头按钮，该木板被破坏了，它会**通知**它周围与它相连的六个方块。木板可以被破坏，也可以被放置；延伸到其他各种方块，它们也都存在各种不同的变化。因此，木板并不会通知周围方块“木板被破坏了”的信息，而是简单地通知“这里发生了一些变化”。当石头按钮受到通知时，它知道“周围发生了变化”，于是检查自己是否还附着在木板上。此时它发现木板被破坏了，自己无法附着，于是变成了掉落物。

这种**通知**行为就称为广义上的**更新**。

## 1.2 更新的类型

在Minecraft中，更新是有多种类型的。

让我们继续上文中的例子：假设在石头按钮边上有一个紧邻着的栅栏门被打开了。石头按钮只会附着在木板这类完整方块上，而栅栏门的变化只是栅栏门开与关的简单状态的变化，相比于木板的放置于破坏显得就不那么明显了。栅栏门开关确实发生了变化，但如果栅栏门打开也要通知石头按钮的话就显得有些多余。因此，栅栏门被打开时，会发出另一种通知，这种通知并不会让石头按钮检查自己是否应该掉落。

这样的通知被称为**PP更新**，而在上文中木板破坏的通知则称为**NC更新**。

比较器是一种能够检测容器中物品数量的红石元件，根据容器中物品数量的多少输出0-15的不同强度高低的红石信号。当容器中物品数量发生变化时，容器并没有必要发出**NC更新**或**PP更新**，但比较器还是能够收到这种变化的“通知”。这是因为容器在容器中物品数量发生变化时，也会发出一种特殊的通知。

这样的通知被称为**比较器更新**。

## 1.3 NC更新

### 1.3.1 NC更新的概念与行为

方块在被放置、破坏、或发生能够显著影响周围方块的变化时，会发出**NC更新**。例如：
- 方块的放置与破坏
- 红石粉能量等级发生变化
- 活塞的推拉*
- ...
  
但一些变化不会发出**NC更新**，最为常见的有：
- 可连接方块的连接状态改变，例如玻璃板与其他方块连接、各种墙与其他方块连接
- 红石粉的连接状态发生变化，例如一个与它南北侧红石粉相连的红石粉又与东侧的一个红石粉相连接
- 活板门、栅栏门的开关
- 发射器、投掷器的激活状态改变（**！重要**）
- 漏斗的激活状态改变
- ...

> 活塞的具体行为不在本篇讨论范围内。

一个发出NC更新的“方块”称为**更新核**，大部分方块发出更新时，更新核是它本身。

更新核发出NC更新时，按照**西东下上北南**的顺序，依次对更新核西侧紧邻、东侧紧邻……的方块发出NC更新。这样的更新就是通常意义上的更新。

部分方块在发出NC更新时不只有一个更新核，它们具有特殊的更新核与范围：
- 红石粉的能力等级变化为二阶毗邻更新*。
- 带有指向的红石元件，例如红石中继器、比较器、侦测器，它们在激活状态发生变化时先单独更新它们输出端指向的方块，再以输出端指向的方块为更新核发出NC更新，并且在NC更新时不会更新它们自身方块。
- 平放的动力铁轨切换激活状态时，先以自身为更新核产生NC更新，再以下方方块为更新核产生NC更新。
- 斜放的动力铁轨切换激活状态时，先以自身为更新核产生NC更新，再以下方方块为更新核产生NC更新，最后以上方方块为更新核产生NC更新。

以上是常见且较为典型的例子。更多的特殊情况可以参见[Wiki-方块更新](https://zh.minecraft.wiki/w/%E6%96%B9%E5%9D%97%E6%9B%B4%E6%96%B0#NC%E6%9B%B4%E6%96%B0)

> 红石粉具有更加复杂的更新行为，本篇中不作展开。~~可能后续会追加红石粉专题DLC~~
> 
> 有关**更新核**的理解在基础部分不作过多解释，且并非所有NC更新都存在更新核。参见进阶部分。

### 1.3.2 NC更新的性质、QC激活、BUD装置

### 1.3.3 PP更新的概念与行为